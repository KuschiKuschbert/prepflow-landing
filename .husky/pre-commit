#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Get staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | tr '\n' ' ')

# Run unified cleanup check on staged files (if any)
if [ -n "$STAGED_FILES" ]; then
  echo "Running cleanup checks on staged files..."
  # Only fail on critical violations, warnings are allowed in pre-commit
  npm run cleanup:staged
  CLEANUP_EXIT=$?
  # Exit code 1 = critical violations, exit code 2 = warnings only
  if [ $CLEANUP_EXIT -eq 1 ]; then
    echo "‚ùå Critical violations found - commit blocked"
    exit 1
  fi
  # Exit code 2 (warnings) or 0 (pass) are allowed
fi

# Run lint-staged for formatting
npm run format:staged

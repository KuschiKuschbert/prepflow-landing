---
alwaysApply: true
---

# Error Patterns & Learned Fixes

This file is automatically generated and updated based on errors encountered and fixes documented in the knowledge base.

## Overview

This file contains error patterns learned from actual errors in the codebase, along with their fixes and prevention strategies.

## How This Works

1. Errors are captured from runtime, build, pre-commit, and CI/CD
2. Fixes are documented when errors are resolved
3. Patterns are extracted and rules are generated
4. This file is updated with learned patterns

## TypeScript Type Errors

### Pattern: Type 'X' is not assignable to type 'Y'

**Detection:**
- TypeScript compiler error: "Type 'X' is not assignable to type 'Y'"
- Common in function parameters, return types, variable assignments

**Fix:**
- Add proper type annotations
- Use type assertions when appropriate (use carefully)
- Fix type definitions

**Prevention:**
- Use strict TypeScript types
- Avoid `any` types without justification
- Define complete type interfaces

**Example:**
```typescript
// ❌ BAD
const value: string = someFunction(); // Error if returns number

// ✅ GOOD
const value: number = someFunction(); // Correct type
```

## Missing Error Handling

### Pattern: Missing try-catch in async functions

**Detection:**
- Async functions without try-catch blocks
- Unhandled promise rejections

**Fix:**
- Wrap async operations in try-catch blocks
- Log errors with logger
- Re-throw or return appropriate error responses

**Prevention:**
- Always wrap async operations in try-catch blocks
- Use logger for error logging (not console.error)
- Use ApiErrorHandler for API routes

**Example:**
```typescript
// ❌ BAD
async function fetchData() {
  const data = await fetch('/api/data');
  return data.json();
}

// ✅ GOOD
async function fetchData() {
  try {
    const data = await fetch('/api/data');
    return data.json();
  } catch (error) {
    logger.error('Failed to fetch data', { error });
    throw error;
  }
}
```

### Pattern: Missing ApiErrorHandler in API routes

**Detection:**
- API routes with error responses not using ApiErrorHandler
- Generic 500 errors without proper formatting

**Fix:**
- Use ApiErrorHandler.createError() for error responses
- Include proper error codes
- Log errors with logger

**Prevention:**
- Always use ApiErrorHandler for API route error responses
- Include error codes as second parameter
- Log errors before returning error response

**Example:**
```typescript
// ❌ BAD
export async function GET(request: NextRequest) {
  try {
    const data = await fetchData();
    return NextResponse.json({ data });
  } catch (error) {
    return NextResponse.json({ error: 'Failed' }, { status: 500 });
  }
}

// ✅ GOOD
import { ApiErrorHandler } from '@/lib/api-error-handler';

export async function GET(request: NextRequest) {
  try {
    const data = await fetchData();
    return NextResponse.json({ data });
  } catch (error) {
    logger.error('Failed to fetch data', { error });
    return ApiErrorHandler.createError('FETCH_DATA_ERROR', 'Failed to fetch data', 500);
  }
}
```

## Database Query Errors

### Pattern: Missing error handling in Supabase queries

**Detection:**
- Supabase queries without error checking
- Unhandled database errors

**Fix:**
- Always check error field from Supabase queries
- Use ApiErrorHandler for database errors
- Log errors with logger

**Prevention:**
- Always check error field: `const { data, error } = await supabase.from('table').select()`
- Use ApiErrorHandler.fromSupabaseError() for database errors
- Never chain .catch() on Supabase query builders

**Example:**
```typescript
// ❌ BAD
const { data } = await supabase.from('table').select();
// Error not checked

// ✅ GOOD
const { data, error } = await supabase.from('table').select();
if (error) {
  logger.error('Database query failed', { error });
  return ApiErrorHandler.fromSupabaseError(error, 'FETCH_DATA_ERROR');
}
```

## Updating This File

This file is automatically updated when:
- Fixes are documented via `scripts/error-learning/document-fix-interactive.js`
- Patterns are detected via `scripts/error-learning/detect-fixes.js`
- Rules are generated via `lib/error-learning/rule-generator.ts`

To manually update, edit this file and add new patterns following the existing format.

## Related Documentation

- `docs/errors/fixes/` - Detailed fix documentation
- `docs/errors/knowledge-base.json` - Structured knowledge base
- `lib/error-learning/` - Error learning utilities

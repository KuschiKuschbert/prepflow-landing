# STAFF MANAGEMENT SKILL

## PURPOSE

Load when working on staff/employee management: employee CRUD, qualifications, onboarding wizard, staff documents, photo upload, or staff QR codes.

## HOW IT WORKS IN THIS CODEBASE

**Key terminology:**

- In UI/routes: "staff" (`/webapp/staff`)
- In API/DB: "employees" (`/api/employees`, `employees` table)
- These are the same thing — the naming is inconsistent (tech debt)

**Data flow:**

1. UI: `app/webapp/staff/page.tsx` + `app/webapp/staff/components/`
2. API: `app/api/employees/` (all staff operations)
3. DB: `employees` table + `employee_qualifications` table
4. Photos: stored in Supabase Storage, URL in `employees.photo_url`
5. Onboarding: `app/webapp/staff/[id]/onboarding/` with wizard UI

**Staff lifecycle:**

1. Create employee → `POST /api/employees`
2. Add qualifications → `POST /api/employees/[id]/qualifications`
3. Complete onboarding → wizard at `/webapp/staff/[id]/onboarding`
4. Onboarding generates documents (built in `lib/staff/onboarding/buildDocuments.ts`)
5. QR code for employee: `GET /api/employees/[id]/qr-code`

**Roster integration:**

- Staff appear in the roster (`/webapp/roster`) via the `roster_shifts` table
- `employees.id` is the foreign key in roster data

## STEP-BY-STEP: Add a new employee field

1. Add column to `employees` table via migration
2. Add to Zod schema in `app/api/employees/helpers/schemas.ts`
3. Update PUT handler
4. Add to `EmployeeForm.tsx` in `app/webapp/staff/components/`
5. Update onboarding wizard if the field is captured during onboarding
6. Update `lib/populate-helpers/` if it's needed in seed data

## STEP-BY-STEP: Add a qualification type

1. Qualification types are stored in `qualification_types` table
2. Fetch via `GET /api/qualification-types`
3. Add new type via admin or seed data
4. Qualifications are linked to employees via `employee_qualifications`

## GOTCHAS

- **"staff" vs "employees":** API routes use `/api/employees`, DB uses `employees` table, but UI shows "Staff". Don't rename — it's a tech debt item.
- **Photo upload:** `POST /api/employees/upload-photo` uses Supabase Storage, not DB column
- **Onboarding documents:** Generated by `lib/staff/onboarding/buildDocuments.ts` — PDFs created with Puppeteer
- **Populate endpoint:** `POST /api/employees/populate` creates sample staff data (dev only)
- **Time & Attendance:** Separate from staff management — `/webapp/time-attendance` uses `clock_events` table

## REFERENCE FILES

- `app/webapp/staff/page.tsx` — staff list page
- `app/webapp/staff/components/EmployeeForm.tsx` — create/edit form
- `app/webapp/staff/components/OnboardingWizard/` — onboarding flow
- `app/api/employees/route.ts` — CRUD handler
- `lib/staff/onboarding/buildDocuments.ts` — document generation

## RETROFIT LOG

### 2025-02-26 — Batch 4 (people & events)

- No violations found. All files pass: no console.\*, no native dialogs, no rogue breakpoints.

## LAST UPDATED

2025-02-26

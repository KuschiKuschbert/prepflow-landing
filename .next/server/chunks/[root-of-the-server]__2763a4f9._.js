module.exports = [
"[project]/.next-internal/server/app/api/performance/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/punycode [external] (punycode, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[project]/lib/supabase.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createSupabaseAdmin",
    ()=>createSupabaseAdmin,
    "supabase",
    ()=>supabase,
    "supabaseAdmin",
    ()=>supabaseAdmin
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
// Client-side Supabase client
const supabaseUrl = ("TURBOPACK compile-time value", "https://dulkrqgjfohsuxhsmofo.supabase.co");
const supabaseAnonKey = ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1bGtycWdqZm9oc3V4aHNtb2ZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NzYwMDMsImV4cCI6MjA3MjU1MjAwM30.b_P98mAantymNfWy1Qz18SaR-LwrPjuaebO2Uj_5JK8");
if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
;
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey);
function createSupabaseAdmin() {
    const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
    if (!serviceRoleKey) {
        throw new Error('Missing SUPABASE_SERVICE_ROLE_KEY environment variable.');
    }
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, serviceRoleKey);
}
const supabaseAdmin = ("TURBOPACK compile-time truthy", 1) ? createSupabaseAdmin() : "TURBOPACK unreachable";
}),
"[project]/app/api/performance/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/supabase.ts [app-route] (ecmascript)");
;
;
async function GET(request) {
    try {
        if (!__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"]) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Database connection not available'
            }, {
                status: 500
            });
        }
        const { data: dishes, error: dishesError } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"].from('menu_dishes').select(`
        *,
        sales_data (
          id,
          number_sold,
          popularity_percentage,
          date
        )
      `).order('created_at', {
            ascending: false
        });
        if (dishesError) {
            console.error('Error fetching dishes:', dishesError);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Database error',
                message: 'Could not retrieve menu dishes from database',
                details: dishesError
            }, {
                status: 500
            });
        }
        // Filter dishes with sales data for analysis
        const dishesWithSales = dishes?.filter((dish)=>dish.sales_data && dish.sales_data.length > 0) || [];
        // Remove duplicates by keeping only the most recent entry for each dish name
        const uniqueDishes = dishes?.reduce((acc, dish)=>{
            const existingDish = acc.find((d)=>d.name === dish.name);
            if (!existingDish || new Date(dish.created_at) > new Date(existingDish.created_at)) {
                // Remove existing entry if it exists
                const filteredAcc = acc.filter((d)=>d.name !== dish.name);
                return [
                    ...filteredAcc,
                    dish
                ];
            }
            return acc;
        }, []) || [];
        // PrepFlow COGS Methodology - Dynamic thresholds based on menu averages
        // Calculate average profit margin across all unique dishes
        const averageProfitMargin = uniqueDishes.length > 0 ? uniqueDishes.reduce((sum, dish)=>sum + dish.profit_margin, 0) / uniqueDishes.length : 70.0; // Default fallback average
        // Calculate average popularity across all dishes with sales data
        const averagePopularity = dishesWithSales.length > 0 ? dishesWithSales.reduce((sum, dish)=>{
            const latestSales = dish.sales_data?.[0];
            return sum + (latestSales?.popularity_percentage || 0);
        }, 0) / dishesWithSales.length : 8.3; // Default fallback average
        // Dynamic thresholds based on PrepFlow methodology
        const profitThreshold = averageProfitMargin; // HIGH if above menu average
        const popularityThreshold = averagePopularity * 0.8; // HIGH if ≥ 80% of average popularity
        const performanceData = uniqueDishes.map((dish)=>{
            const latestSales = dish.sales_data?.[0]; // Get most recent sales data
            const numberSold = latestSales?.number_sold || 0;
            const popularityPercentage = latestSales?.popularity_percentage || 0;
            // Calculate food cost and contribution margin (PrepFlow's key metric)
            // In PrepFlow Excel: profit_margin is actually gross profit percentage
            // Food cost = selling price * (100 - profit_margin) / 100
            const foodCost = dish.selling_price * (100 - dish.profit_margin) / 100;
            const contributionMargin = dish.selling_price - foodCost;
            // Calculate gross profit excluding GST (PrepFlow standard)
            // Assuming 10% GST rate for Australia
            const gstRate = 0.10;
            const grossProfitExclGST = contributionMargin / (1 + gstRate);
            // Calculate Profit Category: HIGH if above menu average, LOW if below (PrepFlow standard)
            const profitCategory = dish.profit_margin >= profitThreshold ? 'High' : 'Low';
            // Calculate Popularity Category: HIGH if ≥ 80% of average popularity, LOW if below (PrepFlow standard)
            const popularityCategory = popularityPercentage >= popularityThreshold ? 'High' : 'Low';
            // Calculate Menu Item Class (combination of Profit Cat + Popularity Cat)
            let menuItemClass;
            if (profitCategory === 'High' && popularityCategory === 'High') {
                menuItemClass = 'Chef\'s Kiss';
            } else if (profitCategory === 'High' && popularityCategory === 'Low') {
                menuItemClass = 'Hidden Gem';
            } else if (profitCategory === 'Low' && popularityCategory === 'High') {
                menuItemClass = 'Bargain Bucket';
            } else {
                menuItemClass = 'Burnt Toast';
            }
            return {
                ...dish,
                number_sold: numberSold,
                popularity_percentage: popularityPercentage,
                profit_category: profitCategory,
                popularity_category: popularityCategory,
                menu_item_class: menuItemClass,
                food_cost: foodCost,
                contribution_margin: contributionMargin,
                gross_profit: grossProfitExclGST,
                gross_profit_percentage: dish.profit_margin
            };
        })// Filter out items with no sales (number_sold = 0 or null)
        .filter((dish)=>dish.number_sold > 0) || [];
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data: performanceData,
            message: 'Performance data retrieved successfully',
            metadata: {
                methodology: 'PrepFlow COGS Dynamic',
                averageProfitMargin: averageProfitMargin,
                averagePopularity: averagePopularity,
                profitThreshold: profitThreshold,
                popularityThreshold: popularityThreshold,
                totalDishes: dishes?.length || 0,
                uniqueDishes: uniqueDishes.length,
                dishesWithSales: dishesWithSales.length
            }
        });
    } catch (error) {
        console.error('Error in performance API:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error',
            message: 'An unexpected error occurred',
            details: error
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const { dish_id, number_sold, popularity_percentage, date } = await request.json();
        if (!dish_id || !number_sold || !popularity_percentage) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Missing required fields',
                message: 'dish_id, number_sold, and popularity_percentage are required'
            }, {
                status: 400
            });
        }
        if (!__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"]) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Database connection not available'
            }, {
                status: 500
            });
        }
        // Upsert sales data
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"].from('sales_data').upsert({
            dish_id: dish_id,
            number_sold: number_sold,
            popularity_percentage: popularity_percentage,
            date: date || new Date().toISOString().split('T')[0]
        }, {
            onConflict: 'dish_id,date'
        }).select();
        if (error) {
            console.error('Error inserting sales data:', error);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Database error',
                message: 'Could not update sales data',
                details: error
            }, {
                status: 500
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data: data,
            message: 'Sales data updated successfully'
        });
    } catch (error) {
        console.error('Error in performance POST API:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error',
            message: 'An unexpected error occurred',
            details: error
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__2763a4f9._.js.map